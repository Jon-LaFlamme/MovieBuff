<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/js/bootstrap-multiselect.js"></script>
    {{ JSGlue.include() }}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/css/bootstrap-multiselect.css" type="text/css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <title>MovieBuff</title>
    <link rel = "icon" href =
            "../static/images/MB.svg"
          type = "image/x-icon">
    <link rel="stylesheet" href="static/MovieBuffStyle.css">

</head>
<body style="background-color:black;color:silver">

<div class="topnav">
    <a class="active" href="{{ url_for('home') }}" style="font-family: papyrus;font-size:25px">MovieBuff</a>
    {%if not session['login'] %}
    <a href="{{ url_for('login') }}" style="font-family: papyrus;font-size:25px">Login</a>
    {%else %}
    <a href="{{ url_for('logout') }}" style="font-family: papyrus;font-size:25px">Log out</a>
    {%endif%}

</div>
<br>

<style>
    .searchResults__result h4 {
        left:300px;
        margin-top: 0px;
        text-transform: uppercase;
    }

    .searchResults__result .resultDescription {
        margin: 0.5em 0 0 0;
        left:300px;
    }
</style>

<!-- SQL Filter/Order page design class="row justify-content-center" class="col text-center"-->
<div class="container">
    <script>
        var services, selectedServices, languages, selectedLanguages, genres, selectedGenres;
    </script>
    <div class="row justify-content-center">
        <div class="col text-begin">
            <div class="dropdown">
                <div class="btn-group">
                    <select id="multiselect2" multiple="multiple">
                        <option value="1">Netflix</option>
                        <option value="2">Prime</option>
                        <option value="3">Hulu</option>
                        <option value="4">Disney</option>
                    </select>
                    <script type="text/javascript">
                            $(document).ready(function() {
                                $('#multiselect2').multiselect({
                                    includeSelectAllOption: true,
                                    buttonWidth: '400px',
                                    nonSelectedText: 'Streaming Services',
                                    allSelectedText: 'All Streaming Services',
                                    nSelectedText: 'Streaming Services',
                                    buttonWidth: '100%',
                                    onChange: function(element, checked) {
                                        services = $('#multiselect2 option:selected');
                                        selectedServices = [];
                                        $(services).each(function(index, services){
                                            selectedServices.push([$(this).text()]);
                                        });
                                    },
                                    onSelectAll: function() {
                                        services = $('#multiselect2 option:selected');
                                        selectedServices = [];
                                        $(services).each(function(index, services){
                                            selectedServices.push([$(this).text()]);
                                        });
                                    }
                                });
                            });
                     </script>
                </div>
                <div class="btn-group">
                    <select id="multiselect3" multiple="multiple">
                        <option value="1">English</option>
                        <option value="2">Spanish</option>
                        <option value="3">German</option>
                        <option value="4">Italian</option>
                        <option value="5">French</option>
                        <option value="6">Russian</option>
                        <option value="7">Danish</option>
                        <option value="8">Swedish</option>
                        <option value="9">Japanese</option>
                        <option value="10">Hindi</option>
                        <option value="11">Mandarin</option>
                        <option value="12">Arabic</option>
                        <option value="13">Korean</option>
                        <option value="14">Hebrew</option>
                        <option value="15">Cantonese</option>
                        <option value="16">Portugese</option>
                        <option value="17">Latin</option>
                        <option value="18">Ukrainian</option>
                        <option value="19">Other</option>
                    </select>
                    <script type="text/javascript">
                            $(document).ready(function() {
                                $('#multiselect3').multiselect({
                                    includeSelectAllOption: true,
                                    buttonWidth: '400px',
                                    nonSelectedText: 'Languages',
                                    allSelectedText: 'All Languages',
                                    nSelectedText: 'Languages',
                                    buttonWidth: '100%',
                                    onChange: function(element, checked) {
                                        languages = $('#multiselect3 option:selected');
                                        selectedLanguages = [];
                                        $(languages).each(function(index, languages){
                                            selectedLanguages.push([$(this).text()]);
                                        });
                                    },
                                    onSelectAll: function() {
                                        languages = $('#multiselect3 option:selected');
                                        selectedLanguages = [];
                                        $(languages).each(function(index, languages){
                                            selectedLanguages.push([$(this).text()]);
                                        });
                                    }
                                });
                                $("#multiselect3").multiselect('selectAll', false);
                                $("#multiselect3").multiselect('updateButtonText');
                                languages = $('#multiselect3 option:selected');
                                        selectedLanguages = [];
                                        $(languages).each(function(index, languages){
                                            selectedLanguages.push([$(this).text()]);
                                        });
                            });
                     </script>
                </div>
                <div class="btn-group">
                    <script type="text/javascript">
                            $(document).ready(function() {
                                $('#multiselect').multiselect({
                                    includeSelectAllOption: true,
                                    buttonWidth: '400px',
                                    nonSelectedText: 'Genres',
                                    allSelectedText: 'All Genres',
                                    nSelectedText: 'Genres',
                                    buttonWidth: '100%',
                                    onChange: function(element, checked) {
                                        genres = $('#multiselect option:selected');
                                        selectedGenres = [];
                                        $(genres).each(function(index, genres){
                                            selectedGenres.push([$(this).text()]);
                                        });
                                    },
                                    onSelectAll: function() {
                                        genres = $('#multiselect option:selected');
                                        selectedGenres = [];
                                        $(genres).each(function(index, genres){
                                            selectedGenres.push([$(this).text()]);
                                        });
                                    }
                                });
                                $("#multiselect").multiselect('selectAll', false);
                                $("#multiselect").multiselect('updateButtonText');
                                genres = $('#multiselect option:selected');
                                        selectedGenres = [];
                                        $(genres).each(function(index, genres){
                                            selectedGenres.push([$(this).text()]);
                                        });
                            });
                    </script>
                    <select id="multiselect" multiple="multiple">
                        <option value="1">Action</option>
                        <option value="2">Adventure</option>
                        <option value="3">Animation</option>
                        <option value="4">Biography</option>
                        <option value="5">Comedy</option>
                        <option value="6">Crime</option>
                        <option value="7">Drama</option>
                        <option value="8">Fantasy</option>
                        <option value="9">History</option>
                        <option value="10">Horror</option>
                        <option value="11">Musical</option>
                        <option value="12">Mystery</option>
                        <option value="13">Romance</option>
                        <option value="14">Sci-Fi</option>
                        <option value="15">Thriller</option>
                        <option value="16">War</option>
                        <option value="17">Western</option>
                    </select>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                        Year
                    </button>
                    <div class="dropdown-menu">
                        <a class="dropdown-item">
                                <script>
                                  $( function() {
                                    $( "#slider-range-year" ).slider({
                                      range: true,
                                      min: 1900,
                                      max: 2021,
                                      values: [ 1900,  2021 ],
                                      slide: function( event, ui ) {
                                        $( "#amountYear" ).val(ui.values[ 0 ] + " - " + ui.values[ 1 ] );
                                      }
                                    });
                                    $( "#amountYear" ).val($( "#slider-range-year" ).slider( "values", 0 ) +
                                      " - " + $( "#slider-range-year" ).slider( "values", 1 ) );
                                  } );
                                </script>
                            <label for="amountYear"></label>
                            <input type="text" id="amountYear" readonly style="border:0; color:blue; font-weight:bold;">
                            <div id="slider-range-year"></div>
                        </a>
                    </div>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                        Rating
                    </button>
                    <div class="dropdown-menu">
                        <a class="dropdown-item">
                                <script>
                                  $( function() {
                                    $( "#slider-range" ).slider({
                                      range: true,
                                      min: 0,
                                      max: 10,
                                      values: [ 0, 10 ],
                                      slide: function( event, ui ) {
                                        $( "#amount" ).val(ui.values[ 0 ] + " - " + ui.values[ 1 ] );
                                      }
                                    });
                                    $( "#amount" ).val($( "#slider-range" ).slider( "values", 0 ) +
                                      " - " + $( "#slider-range" ).slider( "values", 1 ) );
                                  } );
                                </script>
                            <label for="amount">IMDb:</label>
                            <input type="text" id="amount" readonly style="border:0; color:blue; font-weight:bold;">
                            <div id="slider-range"></div>
                        </a>
                    </div>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                        Sort by
                    </button>
                    <div class="dropdown-menu" id="sortSelection">
                        <a class="dropdown-item active">Rating<a>
                        <a class="dropdown-item">Title</a>
                        <a class="dropdown-item">Date</a>
                        <script>
                            var header = document.getElementById("sortSelection");
                            var btns = header.getElementsByClassName("dropdown-item");
                            for (var i = 0; i < btns.length; i++) {
                              btns[i].addEventListener("click", function() {
                              var current = document.getElementsByClassName("dropdown-item active");
                              current[0].className = current[0].className.replace(" active", "");
                              this.className += " active";
                              });
                            }
                        </script>
                    </div>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-primary" onclick="showResults(
                    document.getElementById('amountYear').value, document.getElementById('amount').value,
                    document.getElementById('sortSelection'))" style="background-color:#fff; color:#0069d9">
                        Go
                    </button>
                </div>  
                <span id="searchBox" class="FTS"></span>
                <style>
                    .FTS{
                        height: 70%; /* 100% Full-height */
                        width: 395px; /* 0 width - change this with JavaScript */
                        position: fixed; /* Stay in place */
                        right:1px;
                        }
                </style>

                <script>
                    function showResults(yearRange, imdbRange, sort) {
                        var sortingMethod, year, imdb;
                        sortingMethod = sort.getElementsByClassName("dropdown-item active")[0].innerHTML;
                        var realSortingMethod;
                        year = yearRange.split(" - ");
                        imdb = imdbRange.split(" - ");

                        if (sortingMethod == 'Rating')
                        {
                            realSortingMethod = 'avg_vote';
                        }
                        else if(sortingMethod == 'Title')
                        {
                            realSortingMethod = 'title';
                        }
                        else
                        {
                            realSortingMethod = 'year';
                        }

                        var movies = {
                        'yearStart' : year[0],
                        'yearEnd' : year[1],
                        'languages' : selectedLanguages,
                        'imdbStart' : imdb[0],
                        'imdbEnd' : imdb[1],
                        'sorting' : realSortingMethod,
                        'streaming' : selectedServices,
                        'genres' : selectedGenres
                        }

                        $.ajax({
                            url: Flask.url_for('search'),
                            type: 'POST',
                            data: JSON.stringify(movies),
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json'
                        }).done(function(result){
                                document.getElementById("txtHint").innerHTML = result;
                            })
                            .fail(function(xhr, status, error){
                                document.getElementById("txtHint").innerHTML = xhr.responseText;
                            });
                    }
                </script>

            </div>
        </div>
        <br><br><br>

    </div>
    <div class="row justify-content-center" id="txtHint">Movie info will be listed here...</div>

</div>

<!-- Full Text Search page design elements -->
    <!-- Collapsible sidepanel for Full Text Search Filters -->
    <div id="Facets" class="sidepanel"> 
        <a href="javascript:void(0)" title="Hide Filters" class="closebtn" style="padding-left: 10px" onclick="closeNav()">&#9664;</a>
        <a>Text Search Filters</a> 
        <a href="javascript:void(0)" style="padding-left: 1px" onclick="openNav()" class="openbtn" title="Show Filters">&#9654;</a>
    </div>

<div class="container-fluid">
    <div class="row">
        <div id="mySidenav" class="sidenav">
            
            <div id="clearFilters"></div>
                <ul class="nav nav-sidebar">
                    <div className="panel panel-primary behclick-panel">
                        
                        <li>
                            <div id="genreFacet">
                            </div>
                        </li>
                        <li>
                            <div id="languageFacet">
                            </div>
                        </li>
                    </div>
                </ul>
        </div>
    
        <div>
            <div id="results" class="row placeholders">
            </div>
            <div id="pager" class="row col-sm-3 col-md-offset-30" >pager offset</div>
            </div>
        </div>
    </div>
</div>

<style>
    .sidenav {
      height: 100%; /* 100% Full-height */
      width: 0; /* 0 width - change this with JavaScript */
      position: fixed; /* Stay in place */
      z-index: 1; /* Stay on top */
      top: 20; /* Stay at the top */
      left: 0;
      background-color: black; /* Black*/
      overflow-x: hidden; /* Disable horizontal scroll */
      padding-top:100px; /* Place content 60px from the top */
      transition: 0.5s; /* 0.5 second transition effect to slide in the sidenav */
      border-style: outset;
      border-color: rgb(3, 46, 139);
      border-left: 3px;
    }
    
    /* The navigation menu links */
    .sidenav a {
      padding: 8px 8px 8px 32px;
      text-decoration: none;
      font-size: 25px;
      color: #818181;
      display: block;
      transition: 0.3s;
    }
    
    /* When you mouse over the navigation links, change their color */
    .sidenav a:hover {
      color: #f1f1f1;
    }
    
    /* Position and style the close button (top right corner) */
    .sidenav .closebtn {
      position: absolute;
      top: 250;
      right: 25px;
      font-size: 16px;
      margin-left: 50px;
    }
    
    /* Style page content - use this if you want to push the page content to the right when you open the side navigation */
    #main {
      transition: margin-left .5s;
      padding: 20px;
    }
    
    /* On smaller screens, where height is less than 450px, change the style of the sidenav (less padding and a smaller font size) */
    @media screen and (max-height: 450px) {
      .sidenav {padding-top: 15px;}
      .sidenav a {font-size: 18px;}
    }
    </style>
    <script>
    /* Set the width of the side navigation to 250px */
    function openNav() {
      document.getElementById("mySidenav").style.width = "350px";
    }
    
    /* Set the width of the side navigation to 0 */
    function closeNav() {
      document.getElementById("mySidenav").style.width = "0";
    }
    </script>


<!-- Dependencies -->
<script src="https://cdn.jsdelivr.net/react/15.5.0/react.min.js"></script>
<script src="https://cdn.jsdelivr.net/react/15.5.0/react-dom.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/redux/3.6.0/redux.min.js"></script>
<!-- Main -->
<script src="https://cdn.jsdelivr.net/npm/azsearch.js@0.0.21/dist/AzSearch.bundle.js"></script>
<script>
    // WARNING
    // For demonstration purposes only, do not use in a production environment. For simplicity, this is a single HTML page that has the query key to the search service.
    // CORS (*) must be enabled in the index before using the demo app.

    // Initialize and connect to your search service
    var automagic = new AzSearch.Automagic({ index: "suggester-index-sample", queryKey: "3C3E9F84B7AA8460AB89519711D0CF29", service: "moviebuffsearch" });
    // TODO: In resultTemplate, make href link clickable to results page 
    {% raw %}
    const resultTemplate = `<div class="res">
                            <hr style="width:40%;text-align:left;margin-left:0; margin-top:10; background-color:white">
                            <a href="/{{{imdb_title_id}}}"><h4>{{{title}}}</h4></a>
                            <div class="resultDescription">{{{description}}}</div>
                            </div>
                            <style>
                                .res{
                                    padding-left: 400px;
                                    padding-right:600px;
                                    }
                            </style>`;
    {% endraw %}
    // add a results view using the template defined above
    automagic.addResults("results", { count: true }, resultTemplate);

    // Adds a pager control << 1 2 3 ... >>
    automagic.addPager("pager");
    
    // Set some processors to format results for display
    var suggestionsProcessor = function (results) {
        return results.map(function (result) {
            result.searchText = result["@search.text"];
            return result;
        });
    };

    automagic.store.setSuggestionsProcessor(suggestionsProcessor);
    
    {% raw %}
    var suggestionsTemplate = `
            <p style="color:blue;  background-color:white; z-index: 9;"> Title: {{{title}}} </p> {{{searchText}}}
            `;
    {% endraw %}
    // Add a search box that uses suggester "suggester-1", grabbing some additional fields to display during suggestions. Use the template defined above
    automagic.addSearchBox("searchBox",
        {
            highlightPreTag: "<p>",
            highlightPostTag: "</p>",
            suggesterName: "suggester-1",
            select: "title"
        },
        "",
        suggestionsTemplate);
    
    automagic.addCheckboxFacet("genreFacet", "genre", "string");
    automagic.addCheckboxFacet("languageFacet", "language", "string");


    // Adds a button to clear any applied filters
    automagic.addClearFiltersButton("clearFilters");


</script>

<style>
</style>

</html>
